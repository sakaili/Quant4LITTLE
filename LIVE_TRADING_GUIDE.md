# 实盘Maker交易执行指南

## 📋 脚本说明

[scripts/live_maker_trader.py](scripts/live_maker_trader.py) - 实盘1%资金管理Maker订单执行

### 核心功能

1. ✅ **自动资金管理** - 每笔使用1%可用资金
2. ✅ **读取Paper Trading信号** - 自动加载今日信号
3. ✅ **Maker限价单** - 0.10%偏移获得返佣
4. ✅ **持仓限制** - 最多同时10个仓位
5. ✅ **智能等待** - 60秒超时自动取消
6. ✅ **实时统计** - 显示成交率和资金使用
7. ✅ **持仓监控** - 显示当前所有持仓

---

## 🚀 使用步骤

### 步骤1: 设置环境变量

在PowerShell中执行：

```powershell
# 设置API密钥（你的主网密钥）
$env:BINANCE_API_KEY = "你的API密钥"
$env:BINANCE_API_SECRET = "你的API密钥"

# 设置为实盘模式
$env:USE_TESTNET = "False"

# 代理设置
$env:HTTPS_PROXY = "http://127.0.0.1:7890"
```

### 步骤2: 确保有今日信号

先运行Paper Trading生成今日信号：

```powershell
# 方法A: 运行完整的hourly trading
python scripts\hourly_trading_enhanced.py

# 方法B: 只运行Paper Trading
python scripts\paper_trader.py
```

这会生成 `data/paper_trading/signals_20251124.csv`

### 步骤3: 运行实盘交易

```powershell
cd F:\2025\Quant4Little
python scripts\live_maker_trader.py
```

### 步骤4: 确认执行

脚本会显示详细信息并要求确认：

```
======================================================================
  ⚠️  确认信息
======================================================================
  模式: ⚠️ 实盘 (真实资金)
  可用余额: 163.86 USDT
  每笔金额: 1.64 USDT
  计划开仓: 2 个
  可用槽位: 10 个
======================================================================

  是否继续? (输入 'yes' 确认):
```

输入 `yes` 确认执行。

---

## 📊 资金管理逻辑

### 1%资金计算

```python
# 假设账户余额
available_balance = 163.86 USDT

# 每笔交易金额（1%）
position_value = 163.86 × 0.01 = 1.64 USDT

# 根据当前价格计算数量
# 假设DEXE价格7.321
amount = 1.64 / 7.321 = 0.224 DEXE
```

### 最大持仓控制

```python
max_positions = 10  # 最多10个仓位

# 同时持仓不超过10%资金
max_risk = 163.86 × 10 × 0.01 = 16.39 USDT
```

### 资金使用示例

| 场景 | 可用余额 | 单笔金额(1%) | 10个仓位总计 |
|------|---------|------------|------------|
| 初始 | 163.86 USDT | 1.64 USDT | 16.39 USDT (10%) |
| 盈利10% | 180.25 USDT | 1.80 USDT | 18.02 USDT (10%) |
| 亏损10% | 147.47 USDT | 1.47 USDT | 14.75 USDT (10%) |

---

## 🔄 执行流程

### 完整执行流程

```
启动脚本
    ↓
[1] 连接交易所
    - 验证API密钥
    - 获取账户余额
    ↓
[2] 检查当前持仓
    - 统计持仓数量
    - 计算可用槽位
    ↓
[3] 加载今日信号
    - 读取signals_YYYYMMDD.csv
    - 显示前5个信号
    ↓
[4] 计算开仓参数
    - 每笔1%资金
    - 根据价格计算数量
    ↓
[5] 用户确认
    - 显示详细信息
    - 等待'yes'确认
    ↓
[6] 执行交易
    对每个信号:
      - 获取实时订单簿
      - 计算Maker限价
      - 下限价卖单
      - 等待成交(60秒)
      - 记录结果
    ↓
[7] 统计汇总
    - 成功/失败数量
    - 成交率
    - 资金使用情况
    ↓
[8] 显示持仓
    - 列出所有空头持仓
    - 显示浮动盈亏
```

---

## 📈 输出示例

### 成功执行的输出

```
██████████████████████████████████████████████████████████████████████
  🤖 实盘Maker交易执行 - 1%资金管理
  时间: 2025-11-24 14:00:00
██████████████████████████████████████████████████████████████████████

======================================================================
  🤖 实盘Maker交易执行器
======================================================================
  模式: ⚠️  实盘
  资金管理: 每笔 1.0% 可用资金
  最大持仓: 10 个
  Maker偏移: 0.1%
======================================================================

──────────────────────────────────────────────────────────────────────
  💰 账户信息
──────────────────────────────────────────────────────────────────────
  可用余额: 163.86 USDT
  每笔金额: 1.64 USDT (1%)
  当前持仓: 0 个

──────────────────────────────────────────────────────────────────────
  📊 加载交易信号
──────────────────────────────────────────────────────────────────────
  ✅ 加载今日信号: 2 个

  前5个信号:
           symbol  close  model_score  model_class signal_type
DEXE_USDT_USDT_1d  7.321     0.246265          1.0       SHORT
ORCA_USDT_USDT_1d  1.552     0.003119          1.0       SHORT

======================================================================
  ⚠️  确认信息
======================================================================
  模式: ⚠️ 实盘 (真实资金)
  可用余额: 163.86 USDT
  每笔金额: 1.64 USDT
  计划开仓: 2 个
  可用槽位: 10 个
======================================================================

  是否继续? (输入 'yes' 确认): yes

======================================================================
  🚀 开始执行交易
======================================================================

──────────────────────────────────────────────────────────────────────
  信号 1/2
──────────────────────────────────────────────────────────────────────
  标的: DEXE_USDT_USDT_1d
  当前价: 7.3210
  开仓数量: 0.2240
  开仓金额: 1.64 USDT
  模型分类: Class 1.0
  📝 做空入场: DEXE_USDT_USDT_1d
    限价: 7.3283
    数量: 0.2240
    盘口: Bid=7.3174, Ask=7.3246
  ✅ 订单已下达! ID: 12345678
  ✅ 成交! 价格: 7.3283
  ✅ 做空入场成功!

──────────────────────────────────────────────────────────────────────
  信号 2/2
──────────────────────────────────────────────────────────────────────
  标的: ORCA_USDT_USDT_1d
  当前价: 1.5520
  开仓数量: 1.0568
  开仓金额: 1.64 USDT
  模型分类: Class 1.0
  📝 做空入场: ORCA_USDT_USDT_1d
    限价: 1.5536
    数量: 1.0568
    盘口: Bid=1.5512, Ask=1.5528
  ✅ 订单已下达! ID: 12345679
  ✅ 成交! 价格: 1.5536
  ✅ 做空入场成功!

======================================================================
  📊 执行结果
======================================================================
  成功: 2 个
  失败: 0 个
  成交率: 100.0%
  使用资金: 3.28 USDT (2%)
  剩余资金: 160.58 USDT
======================================================================

──────────────────────────────────────────────────────────────────────
  💼 当前持仓
──────────────────────────────────────────────────────────────────────
  📉 DEXE_USDT_USDT_1d
     数量: 0.2240
     入场价: 7.3283
     标记价: 7.3200
     浮动盈亏: +0.02 USDT
  📉 ORCA_USDT_USDT_1d
     数量: 1.0568
     入场价: 1.5536
     标记价: 1.5500
     浮动盈亏: +0.04 USDT

======================================================================
  ✅ 执行完成!
======================================================================
```

---

## ⚙️ 参数配置

### 修改资金比例

编辑 [scripts/live_maker_trader.py](scripts/live_maker_trader.py) 第64行：

```python
trader = LiveMakerTrader(
    position_pct=0.01,  # 改为0.02表示2%，0.005表示0.5%
    ...
)
```

### 修改最大持仓数

编辑第68行：

```python
trader = LiveMakerTrader(
    max_positions=10,  # 改为20表示最多20个仓位
    ...
)
```

### 修改Maker偏移

编辑第66行：

```python
trader = LiveMakerTrader(
    maker_offset_pct=0.10,  # 改为0.05或0.15
    ...
)
```

---

## 🔒 安全机制

### 1. 资金保护

- ✅ 单笔最多1%资金
- ✅ 最多10个仓位（总计10%）
- ✅ 动态计算可用余额

### 2. 持仓保护

- ✅ 自动检查当前持仓数
- ✅ 达到上限自动停止开仓
- ✅ 避免过度集中风险

### 3. 执行保护

- ✅ 用户必须确认才执行
- ✅ 显示详细信息
- ✅ Maker订单超时自动取消

### 4. 错误处理

- ✅ API连接失败保护
- ✅ 下单失败跳过继续
- ✅ 异常自动捕获

---

## ⚠️ 重要提示

### 使用前必读

1. **这是真实交易！**
   - 使用真实资金
   - 可能产生亏损
   - 请谨慎操作

2. **先小额测试**
   - 建议先用少量资金测试（如10-50 USDT）
   - 观察1-2天效果
   - 满意后再增加资金

3. **定期检查**
   - 每天检查持仓
   - 监控浮动盈亏
   - 及时调整策略

4. **风险控制**
   - 设置止损
   - 不要过度杠杆
   - 保持理性

---

## 📊 与Paper Trading集成

### 自动化流程

```bash
# 每小时运行（推荐）
# 1. 生成Paper Trading信号
python scripts/hourly_trading_enhanced.py

# 2. 执行实盘交易
python scripts/live_maker_trader.py
```

### Windows任务计划程序

创建批处理文件 `run_hourly_live_trading.bat`:

```batch
@echo off
cd /d F:\2025\Quant4Little

REM 先生成信号
python scripts\hourly_trading_enhanced.py

REM 等待5秒
timeout /t 5 /nobreak

REM 执行实盘交易（需要手动确认）
python scripts\live_maker_trader.py
```

**注意**: 由于需要手动确认，不建议完全自动化执行。

---

## 📈 收益预期

### 基于1%资金管理

假设账户163.86 USDT，每天开10个仓位：

**保守估计**（平均收益5%，成交率80%）：
```
每笔盈利: 1.64 × 5% = 0.082 USDT
每天10笔: 0.082 × 8 = 0.656 USDT
月收益: 0.656 × 30 = 19.68 USDT (12%)
```

**理想情况**（平均收益10%，成交率90%）：
```
每笔盈利: 1.64 × 10% = 0.164 USDT
每天10笔: 0.164 × 9 = 1.476 USDT
月收益: 1.476 × 30 = 44.28 USDT (27%)
```

**风险情况**（平均亏损5%，成交率100%）：
```
每笔亏损: 1.64 × 5% = 0.082 USDT
每天10笔: -0.82 USDT
月亏损: -24.60 USDT (-15%)
```

---

## 🎯 最佳实践

### 1. 开仓时机

- ✅ 每小时运行Paper Trading后
- ✅ 市场波动性较高时
- ✅ 信号质量较好时（Class 2）

### 2. 持仓管理

- ✅ 定期检查浮动盈亏
- ✅ 盈利超过10%考虑提前止盈
- ✅ 亏损超过5%考虑止损

### 3. 资金管理

- ✅ 初期使用0.5-1%资金
- ✅ 稳定后可增加到2%
- ✅ 最多不超过5%

### 4. 风险控制

- ✅ 总持仓不超过可用资金20%
- ✅ 单个币种不超过总仓位30%
- ✅ 设置账户止损线（如总亏损20%停止交易）

---

## 📖 相关文档

- [MAKER_ORDER_STRATEGY.md](MAKER_ORDER_STRATEGY.md) - Maker订单策略详解
- [scripts/maker_order_utils.py](scripts/maker_order_utils.py) - Maker订单工具
- [TESTNET_MAKER_GUIDE.md](TESTNET_MAKER_GUIDE.md) - 测试网使用指南
- [QUICK_START.md](QUICK_START.md) - 快速启动指南

---

祝交易顺利！🚀
