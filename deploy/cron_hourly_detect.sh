#!/bin/bash
################################################################################
# 定时任务 - 小时级信号检测与交易执行 (带Transformer模型排序)
# 每小时执行一次
################################################################################

set -e

echo "========================================================================"
echo "  小时级信号检测 (Transformer模型) - $(date '+%Y-%m-%d %H:%M:%S')"
echo "========================================================================"

# 加载环境变量
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

if [ -f "$PROJECT_ROOT/.env" ]; then
    export $(grep -v '^#' "$PROJECT_ROOT/.env" | xargs)
fi

cd "$PROJECT_ROOT"

# 检测信号并自动执行交易（使用Transformer模型排序）
echo "  检测候选池中的入场信号（使用模型）..."
echo ""

python3 scripts/hourly_signal_detector.py \
  --use-model \
  --top-k 10 \
  --execute \
  --auto-confirm

echo ""
echo "========================================================================"
echo "  完成 - $(date '+%Y-%m-%d %H:%M:%S')"
echo "========================================================================"
