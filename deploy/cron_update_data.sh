#!/bin/bash
################################################################################
# 定时任务 - 更新数据
# 每日UTC 01:00执行 (北京时间09:00)
################################################################################

set -e

echo "════════════════════════════════════════════════════════════════════════════"
echo "  🔄 数据更新任务 - $(date '+%Y-%m-%d %H:%M:%S')"
echo "════════════════════════════════════════════════════════════════════════════"

# 加载环境变量
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

if [ -f "$PROJECT_ROOT/.env" ]; then
    export $(grep -v '^#' "$PROJECT_ROOT/.env" | xargs)
fi

cd "$PROJECT_ROOT"

# 更新数据
echo "  [1/2] 更新日线数据..."
timeout 600 python3 scripts/update_latest_data.py 2>&1 | head -50

echo ""
echo "  [2/2] 更新小时线数据..."
# 如果有单独的小时线更新脚本，在这里调用

echo ""
echo "════════════════════════════════════════════════════════════════════════════"
echo "  ✅ 数据更新完成 - $(date '+%Y-%m-%d %H:%M:%S')"
echo "════════════════════════════════════════════════════════════════════════════"
