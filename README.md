# Quant4Little - åŠ å¯†è´§å¸é‡åŒ–äº¤æ˜“ç³»ç»Ÿ

ä¸€ä¸ªåŸºäºæŠ€æœ¯æŒ‡æ ‡å’ŒTransformeræ·±åº¦å­¦ä¹ æ¨¡å‹çš„åŠ å¯†è´§å¸é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œä¸“æ³¨äºBinance USDTæ°¸ç»­åˆçº¦å¸‚åœºçš„ä½æµåŠ¨æ€§æ ‡çš„ã€‚

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è§ˆ](#ç³»ç»Ÿæ¦‚è§ˆ)
- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [äº¤æ˜“ç­–ç•¥](#äº¤æ˜“ç­–ç•¥)
- [æ¨¡å‹ä½¿ç”¨](#æ¨¡å‹ä½¿ç”¨)
- [é£é™©æ§åˆ¶](#é£é™©æ§åˆ¶)
- [ç›‘æ§è¿ç»´](#ç›‘æ§è¿ç»´)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿæ¦‚è§ˆ

### é¡¹ç›®å®šä½

æœ¬ç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„é‡åŒ–äº¤æ˜“æ¡†æ¶ï¼Œé€‚ç”¨äºBinance USDTæ°¸ç»­åˆçº¦å¸‚åœºã€‚ç³»ç»Ÿé‡‡ç”¨**å°æ—¶çº§ä¿¡å·æ£€æµ‹**æ¶æ„ï¼Œç»“åˆä¼ ç»ŸæŠ€æœ¯æŒ‡æ ‡å’Œæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå®ç°è‡ªåŠ¨åŒ–çš„å€™é€‰ç­›é€‰ã€ä¿¡å·æ£€æµ‹ã€è®¢å•æ‰§è¡Œå’Œé£é™©ç®¡ç†ã€‚

### æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.10+
- **äº¤æ˜“æ¥å£**: ccxt
- **æ·±åº¦å­¦ä¹ **: PyTorch, Transformer
- **æ•°æ®å¤„ç†**: pandas, numpy
- **éƒ¨ç½²**: Linux Cron (æ”¯æŒECS/Ubuntu)

### ç³»ç»Ÿå·¥ä½œæµ

```
æ¯å¤©09:00 â†’ ç­›é€‰å€™é€‰æ± (100ä¸ªå¸) â†’ å€™é€‰åˆ—è¡¨CSV
æ¯å°æ—¶æ•´ç‚¹ â†’ æ£€æµ‹ä¿¡å·(KDJ+EMA+ATR) â†’ Transformeræ¨¡å‹æ’åº â†’ å¹¶è¡Œä¸‹å•(Top-10)
æŒä»“ç®¡ç† â†’ æ­¢ç›ˆæ­¢æŸç›‘æ§ â†’ è§¦å‘æ­¢ç›ˆ/æ­¢æŸå¹³ä»“
```

---

## æ ¸å¿ƒç‰¹æ€§

### 1. æ™ºèƒ½å€™é€‰ç­›é€‰
- åŸºäºæµåŠ¨æ€§å’Œå¸‚å€¼å€’æ•°ç­›é€‰ä½æµåŠ¨æ€§æ ‡çš„
- æˆäº¤é‡è¿‡æ»¤(>500ä¸‡USDT)
- è‡ªåŠ¨ç”Ÿæˆæ¯æ—¥å€™é€‰æ± (100ä¸ªæ ‡çš„)

### 2. å°æ—¶çº§ä¿¡å·æ£€æµ‹
- å®æ—¶ç›‘æ§å€™é€‰æ± 
- å¤šæŒ‡æ ‡ä¿¡å·ç¡®è®¤:
  - KDJåå¼¹ä¿¡å·(J > 50)
  - EMAåº•éƒ¨å½¢æ€(EMA10 < EMA20 < EMA30)
  - ATRæ³¢åŠ¨ç‡è¿‡æ»¤(â‰¥2%)

### 3. Transformeræ¨¡å‹æ’åº
- 15ç»´è¡¨æ ¼ç‰¹å¾:
  - EMAæŒ‡æ ‡: ema10, ema20, ema30åŠå…¶æ¯”ç‡
  - ATRæ³¢åŠ¨ç‡: atr14, atr14_over_close
  - å¸‚åœºç‰¹å¾: funding_rate, log_quote_volume, log_market_cap
  - æ”¶ç›Šç‰¹å¾: ret_mean_5d, ret_std_5d
  - æ–œç‡ç‰¹å¾: ema10_slope, ema20_slope

- 24Ã—5æ—¶åºç‰¹å¾(24å°æ—¶Kçº¿):
  - close, volume, ema20, ema30, atr14

- è¾“å‡º:
  - expected_value: æœŸæœ›æ”¶ç›Šåˆ†æ•°(-0.5åˆ°0.5)
  - pred_class: é¢„æµ‹ç±»åˆ«(0=å·®, 1=ä¸­, 2=ä¼˜)
  - ä¸‰ç±»æ¦‚ç‡åˆ†å¸ƒ

- è‡ªåŠ¨å›é€€æœºåˆ¶: æ¨¡å‹å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°KDJæ’åº

### 4. Makerè®¢å•ç­–ç•¥
- é™ä»·å•æŒ‚å•è·å–è¿”ä½£(0.02%)
- 0.10%åç§»é‡ä¼˜åŒ–æˆäº¤ç‡
- 5æ¬¡æ¸è¿›å¼è¿½å•é‡è¯•:
  - 0.10% â†’ 0.08% â†’ 0.05% â†’ 0.03% â†’ 0.01%
  - æœ€ç»ˆå¸‚ä»·å…œåº•(0%)
- 60ç§’è¶…æ—¶è‡ªåŠ¨å–æ¶ˆ

### 5. å¹¶è¡Œæ‰§è¡Œå¼•æ“
- ThreadPoolExecutorå¹¶å‘ä¸‹å•(5ä¸ªworker)
- æ™ºèƒ½èµ„é‡‘ç®¡ç†(æ¯ç¬”1%å¯ç”¨èµ„é‡‘)
- æœ€å¤§æŒä»“é™åˆ¶(10ä¸ªå“ç§)
- å®æ—¶æˆäº¤ç»Ÿè®¡

### 6. é£é™©ç®¡ç†
- å•å“ç§èµ„é‡‘é™åˆ¶: 1%è´¦æˆ·æ€»èµ„é‡‘
- æœ€å¤§æŒä»“æ•°: 10ä¸ªå“ç§
- æ­¢æŸæ­¢ç›ˆ: 30%æ­¢ç›ˆ / 150%æ­¢æŸ
- æŒä»“ç›‘æ§: å®æ—¶æ˜¾ç¤ºå½“å‰æ‰€æœ‰æŒä»“

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/xxx/Quant4Little.git
cd Quant4Little

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. é…ç½®ç¯å¢ƒå˜é‡
export BINANCE_API_KEY="ä½ çš„APIå¯†é’¥"
export BINANCE_API_SECRET="ä½ çš„APIå¯†é’¥"
export USE_TESTNET="False"  # Trueä¸ºæµ‹è¯•ç½‘
export HTTPS_PROXY="http://127.0.0.1:7890"  # å¯é€‰ä»£ç†
```

### æœ¬åœ°æµ‹è¯•

#### 1. å›æµ‹éªŒè¯ç­–ç•¥

```bash
python scripts/backtester.py \
  --start 2025-01-01 \
  --end 2025-11-01 \
  --max-positions 30 \
  --bottom-n 100
```

è¾“å‡ºåŒ…å«:
- æƒç›Šæ›²çº¿å›¾
- äº¤æ˜“æ˜ç»†CSV
- Sharpeæ¯”ç‡
- æœ€å¤§å›æ’¤

#### 2. ç”Ÿæˆå€™é€‰æ± 

```bash
python scripts/daily_candidate_scan.py --top-n 100
```

ç”Ÿæˆæ–‡ä»¶: `data/daily_scans/candidates_YYYYMMDD.csv`

#### 3. æ£€æµ‹å°æ—¶çº§ä¿¡å·(ä½¿ç”¨æ¨¡å‹)

```bash
python scripts/hourly_signal_detector.py \
  --use-model \
  --top-k 10
```

ç”Ÿæˆæ–‡ä»¶: `data/hourly_signals/signals_YYYYMMDD_HH.csv`

#### 4. çº¸é¢äº¤æ˜“æµ‹è¯•

```bash
python scripts/live_maker_trader.py
# æŒ‰æç¤ºç¡®è®¤æ‰§è¡Œ
```

---

## ç³»ç»Ÿæ¶æ„

### ç›®å½•ç»“æ„

```
Quant4Little/
â”œâ”€â”€ scripts/                    # æ ¸å¿ƒè„šæœ¬
â”‚   â”œâ”€â”€ data_fetcher.py        # æ•°æ®è·å–(æ”¯æŒä¸»ç½‘/æµ‹è¯•ç½‘)
â”‚   â”œâ”€â”€ daily_candidate_scan.py # æ¯æ—¥å€™é€‰æ± ç­›é€‰
â”‚   â”œâ”€â”€ hourly_signal_detector.py # å°æ—¶çº§ä¿¡å·æ£€æµ‹+æ¨¡å‹æ’åº
â”‚   â”œâ”€â”€ live_maker_trader.py   # å®ç›˜Makerè®¢å•æ‰§è¡Œ
â”‚   â”œâ”€â”€ backtester.py          # äº‹ä»¶é©±åŠ¨å›æµ‹å™¨
â”‚   â”œâ”€â”€ indicator_utils.py     # æŠ€æœ¯æŒ‡æ ‡å·¥å…·(KDJç­‰)
â”‚   â”œâ”€â”€ lightweight_ranker.py  # è½»é‡çº§æ¨¡å‹æ¨ç†å™¨
â”‚   â””â”€â”€ modeling/              # æ·±åº¦å­¦ä¹ æ¨¡å—
â”‚       â”œâ”€â”€ model.py           # Transformeræ¨¡å‹å®šä¹‰
â”‚       â”œâ”€â”€ features.py        # ç‰¹å¾å·¥ç¨‹
â”‚       â””â”€â”€ train_ranker.py    # æ¨¡å‹è®­ç»ƒ
â”œâ”€â”€ deploy/                     # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ clear_crontab.sh       # æ¸…ç†å®šæ—¶ä»»åŠ¡
â”‚   â”œâ”€â”€ setup_cron_hourly.sh   # å®‰è£…å°æ—¶çº§å®šæ—¶ä»»åŠ¡
â”‚   â””â”€â”€ cron_hourly_detect.sh  # å°æ—¶çº§æ£€æµ‹cronè„šæœ¬
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•(è¢«.gitignore)
â”‚   â”œâ”€â”€ daily_klines/          # æ—¥çº¿æ•°æ®
â”‚   â”œâ”€â”€ hourly_klines/         # å°æ—¶çº¿æ•°æ®
â”‚   â”œâ”€â”€ daily_scans/           # å€™é€‰æ± CSV
â”‚   â”œâ”€â”€ hourly_signals/        # å°æ—¶ä¿¡å·CSV
â”‚   â””â”€â”€ backtest_trades.csv    # äº¤æ˜“è®°å½•(è®­ç»ƒæ•°æ®)
â”œâ”€â”€ models/                     # æ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ rank_model.pt          # PyTorchæ¨¡å‹æƒé‡
â”‚   â”œâ”€â”€ rank_model.onnx        # ONNXä¼˜åŒ–æ¨¡å‹(å¯é€‰)
â”‚   â””â”€â”€ rank_model_meta.json   # æ¨¡å‹å…ƒæ•°æ®(å½’ä¸€åŒ–å‚æ•°)
â”œâ”€â”€ logs/                       # æ—¥å¿—ç›®å½•
â”œâ”€â”€ tests/                      # æµ‹è¯•è„šæœ¬
â””â”€â”€ README.md                   # æœ¬æ–‡æ¡£
```

### æ•°æ®æµ

```
[Binance API]
    â†“
[data_fetcher.py] â†’ è·å–Kçº¿æ•°æ®
    â†“
[daily_klines/] [hourly_klines/] â†’ å­˜å‚¨å†å²æ•°æ®
    â†“
[daily_candidate_scan.py] â†’ ç­›é€‰å€™é€‰æ± 
    â†“
[daily_scans/candidates_YYYYMMDD.csv] â†’ å€™é€‰åˆ—è¡¨
    â†“
[hourly_signal_detector.py] â†’ æ£€æµ‹ä¿¡å·
    â†“                              â†“
[indicator_utils.py]          [modeling/features.py]
    â†“                              â†“
[æŠ€æœ¯æŒ‡æ ‡è¿‡æ»¤]               [æ„å»ºæ¨¡å‹ç‰¹å¾]
    â†“                              â†“
[ä¼ ç»Ÿä¿¡å·] â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ [lightweight_ranker.py]
    â†“                              â†“
                [Transformeræ¨¡å‹æ’åº]
                        â†“
        [hourly_signals/signals_YYYYMMDD_HH.csv]
                        â†“
            [live_maker_trader.py]
                        â†“
                [å¹¶è¡Œä¸‹å•+æŒä»“ç®¡ç†]
                        â†“
                [Binanceè®¢å•ç°¿]
```

---

## éƒ¨ç½²æŒ‡å—

### ECSæœåŠ¡å™¨éƒ¨ç½²(æ¨è)

#### ç¬¬ä¸€æ­¥: æ‹‰å–ä»£ç 

```bash
cd ~/Quant4Little
git pull origin main
```

#### ç¬¬äºŒæ­¥: æ¸…ç†æ—§å®šæ—¶ä»»åŠ¡

```bash
cd ~/Quant4Little
bash deploy/clear_crontab.sh
```

è„šæœ¬ä¼š:
- è‡ªåŠ¨å¤‡ä»½å½“å‰crontabåˆ°`/tmp/crontab_backup_*.txt`
- åˆ é™¤æ‰€æœ‰Quant4Littleç›¸å…³ä»»åŠ¡
- æ˜¾ç¤ºæ¸…ç†ç»“æœ

#### ç¬¬ä¸‰æ­¥: å®‰è£…æ–°å®šæ—¶ä»»åŠ¡

```bash
bash deploy/setup_cron_hourly.sh
# æ˜¾ç¤ºå°†è¦å®‰è£…çš„ä»»åŠ¡åï¼Œè¾“å…¥ y ç¡®è®¤
```

å®‰è£…çš„å®šæ—¶ä»»åŠ¡:

```bash
# æ¯å¤©09:00 (UTC 01:00) - ç­›é€‰å€™é€‰å¸æ± 
0 1 * * * cd ~/Quant4Little && python3 scripts/daily_candidate_scan.py --top-n 100 >> logs/cron_candidates.log 2>&1

# æ¯å°æ—¶æ•´ç‚¹ - æ£€æµ‹ä¿¡å·å¹¶æ‰§è¡Œäº¤æ˜“(ä½¿ç”¨Transformeræ¨¡å‹)
0 * * * * cd ~/Quant4Little && bash deploy/cron_hourly_detect.sh >> logs/cron_hourly.log 2>&1
```

#### ç¬¬å››æ­¥: éªŒè¯å®‰è£…

```bash
# æŸ¥çœ‹å·²å®‰è£…çš„å®šæ—¶ä»»åŠ¡
crontab -l

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p ~/Quant4Little/logs

# ç¡®ä¿è„šæœ¬å¯æ‰§è¡Œ
chmod +x ~/Quant4Little/deploy/*.sh

# æ‰‹åŠ¨æµ‹è¯•å€™é€‰æ± ç­›é€‰
python3 scripts/daily_candidate_scan.py --top-n 100

# æ‰‹åŠ¨æµ‹è¯•ä¿¡å·æ£€æµ‹(éœ€è¦å…ˆæœ‰å€™é€‰æ± )
python3 scripts/hourly_signal_detector.py --use-model --top-k 10
```

#### ç¬¬äº”æ­¥: ç›‘æ§è¿è¡Œ

```bash
# å®æ—¶ç›‘æ§å°æ—¶çº§æ£€æµ‹æ—¥å¿—
tail -f logs/cron_hourly.log

# å®æ—¶ç›‘æ§å€™é€‰æ± ç­›é€‰æ—¥å¿—
tail -f logs/cron_candidates.log

# æŸ¥çœ‹ç³»ç»Ÿcronæ—¥å¿—
sudo grep CRON /var/log/syslog | tail -20

# æŸ¥çœ‹ç”Ÿæˆçš„ä¿¡å·æ–‡ä»¶
ls -lh data/hourly_signals/
```

### æ‰§è¡Œæ—¶é—´è¡¨(åŒ—äº¬æ—¶é—´)

| æ—¶é—´ | ä»»åŠ¡ | è¯´æ˜ |
|------|------|------|
| 09:00 | ç­›é€‰å€™é€‰æ±  | æ‰«æå…¨å¸‚åœºï¼Œé€‰å‡º100ä¸ªå€™é€‰å¸ |
| 10:00 | æ£€æµ‹ä¿¡å·+äº¤æ˜“ | ä½¿ç”¨Transformeræ¨¡å‹æ’åºï¼Œæ‰§è¡ŒTop-10 |
| 11:00 | æ£€æµ‹ä¿¡å·+äº¤æ˜“ | åŒä¸Š |
| ... | ... | æ¯å°æ—¶é‡å¤ |
| 23:00 | æ£€æµ‹ä¿¡å·+äº¤æ˜“ | æœ€åä¸€æ¬¡ |

---

## äº¤æ˜“ç­–ç•¥

### å€™é€‰æ± ç­›é€‰é€»è¾‘

æ¯å¤©09:00æ‰§è¡Œï¼Œç­›é€‰æ¡ä»¶:

1. **æµåŠ¨æ€§è¿‡æ»¤**:
   - æŒ‰24å°æ—¶æˆäº¤é¢å€’æ•°æ’åº
   - æŒ‰å¸‚å€¼å€’æ•°æ’åº
   - å–ä¸¤è€…äº¤é›†ä½œä¸º"ç©ºæ°”å¸æ± "

2. **æŠ€æœ¯æŒ‡æ ‡è¿‡æ»¤**:
   - EMAæ’åˆ—: EMA10 < EMA20 < EMA30 (åº•éƒ¨å½¢æ€)
   - ATRæ³¢åŠ¨ç‡æ— æç«¯æš´æ¶¨(ATR < 3å€å‰3æ—¥å‡å€¼)

3. **é£é™©æ§åˆ¶è¿‡æ»¤**:
   - æ’é™¤ä¸»æµå¸(BTC, ETH, BNB, SOLç­‰)
   - èµ„é‡‘è´¹ç‡ > -1% (é¿å…æç«¯è´Ÿè´¹ç‡)

4. **æ’åºè§„åˆ™**:
   - æŒ‰EMA10å‡åºæ’åˆ—
   - é€‰å‡ºåº•éƒ¨100ä¸ªæ ‡çš„

### ä¿¡å·æ£€æµ‹é€»è¾‘

æ¯å°æ—¶æ•´ç‚¹æ‰§è¡Œï¼Œä»å€™é€‰æ± æ£€æµ‹:

1. **æŠ€æœ¯ä¿¡å·ç¡®è®¤**:
   - KDJ_J > 50 (å¼€å§‹åå¼¹)
   - EMA10 < EMA20 < EMA30 (ä»åœ¨åº•éƒ¨)
   - ATRæ³¢åŠ¨ç‡ â‰¥ 2% (æ³¢åŠ¨è¶³å¤Ÿ)

2. **æ¨¡å‹æ™ºèƒ½æ’åº**(å¯é€‰):
   - å¯¹æ‰€æœ‰æŠ€æœ¯ä¿¡å·è¿›è¡Œæ¨¡å‹è¯„åˆ†
   - è®¡ç®—expected_value (æœŸæœ›æ”¶ç›Š)
   - æŒ‰åˆ†æ•°é™åºæ’åˆ—

3. **Top-Ké€‰æ‹©**:
   - é»˜è®¤é€‰æ‹©Top-10ä¸ªä¿¡å·
   - è¿‡æ»¤æ‰æ¨¡å‹åˆ†æ•°<-0.9çš„æ— æ•ˆä¿¡å·
   - æ¨¡å‹å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°KDJé™åºæ’åˆ—

### Makerè®¢å•æ‰§è¡Œç­–ç•¥

**å…¥åœºé€»è¾‘**:

```
å½“å‰å¸‚åœºçŠ¶æ€:
  Ask (å–1): 7.305 USDT
  Bid (ä¹°1): 7.300 USDT

Makerç­–ç•¥(åšç©ºå¼€ä»“):
  â†’ åœ¨Askä¹‹ä¸ŠæŒ‚é™ä»·å–å•
  â†’ ä»·æ ¼: 7.305 Ã— (1 + 0.10%) = 7.312 USDT
  â†’ ç­‰å¾…60ç§’æˆäº¤
  â†’ æœªæˆäº¤åˆ™å–æ¶ˆè®¢å•ï¼Œé‡è¯•æ›´æ¿€è¿›çš„ä»·æ ¼
```

**è¿½å•ç­–ç•¥**(5æ¬¡é‡è¯•):
1. ç¬¬1æ¬¡: offset=0.10% (ä¿å®ˆ)
2. ç¬¬2æ¬¡: offset=0.08%
3. ç¬¬3æ¬¡: offset=0.05%
4. ç¬¬4æ¬¡: offset=0.03%
5. ç¬¬5æ¬¡: offset=0.01% (æ¿€è¿›)
6. æœ€ç»ˆ: offset=0% (å¸‚ä»·å…œåº•)

**èµ„é‡‘ç®¡ç†**:
- æ¯ç¬”ä½¿ç”¨è´¦æˆ·å¯ç”¨èµ„é‡‘çš„1%
- è®¡ç®—å…¬å¼: amount = (balance Ã— 0.01) / price
- æ æ†: 1x (ç°è´§åŒ–åˆçº¦)

### KDJæŒ‡æ ‡è®¡ç®—

ä½¿ç”¨æ ‡å‡†KDJç®—æ³•:

```
1. RSV = (Close - Lowest_Low_9) / (Highest_High_9 - Lowest_Low_9) Ã— 100

2. K(today) = (2/3) Ã— K(yesterday) + (1/3) Ã— RSV(today)
   åˆå§‹Kå€¼ = 50

3. D(today) = (2/3) Ã— D(yesterday) + (1/3) Ã— K(today)
   åˆå§‹Då€¼ = 50

4. J = 3 Ã— K - 2 Ã— D
```

å®ç°ä½ç½®: [scripts/indicator_utils.py](scripts/indicator_utils.py)

---

## æ¨¡å‹ä½¿ç”¨

### æ¨¡å‹æ¶æ„

**TransformerRanker** - å¤šæ¨¡æ€Transformeræ’åºæ¨¡å‹

- **è¡¨æ ¼ç‰¹å¾åˆ†æ”¯**: 15ç»´ç‰¹å¾ â†’ FC(64) â†’ Dropout(0.3)
- **åºåˆ—ç‰¹å¾åˆ†æ”¯**: (24, 5) â†’ Transformer Encoder â†’ æ± åŒ–
- **èåˆå±‚**: æ‹¼æ¥ â†’ FC(64) â†’ ReLU â†’ Dropout(0.3) â†’ FC(3)
- **è¾“å‡º**: 3åˆ†ç±» (Class 0/1/2)

### è®­ç»ƒæ¨¡å‹

```bash
python scripts/modeling/train_ranker.py \
  --candidates-dir data/daily_scans \
  --backtest-csv data/backtest_trades.csv \
  --daily-dir data/daily_klines \
  --hourly-dir data/hourly_klines \
  --output-dir models \
  --epochs 50 \
  --batch-size 64
```

ç”Ÿæˆæ–‡ä»¶:
- `models/rank_model.pt` - PyTorchæ¨¡å‹æƒé‡
- `models/rank_model_meta.json` - å½’ä¸€åŒ–å‚æ•°å’Œå…ƒæ•°æ®

### ä½¿ç”¨æ¨¡å‹æ¨ç†

#### æ–¹æ³•1: å‘½ä»¤è¡Œä½¿ç”¨

```bash
# å¯¹æŒ‡å®šæ—¥æœŸçš„å€™é€‰è¿›è¡Œæ’åº
python scripts/use_ranker_model.py --date 20250120 --top-k 20
```

#### æ–¹æ³•2: åœ¨ä»£ç ä¸­ä½¿ç”¨

```python
from scripts.lightweight_ranker import LightweightRanker
from scripts.modeling.features import build_tabular_vector, build_hourly_sequence
import pandas as pd
from pathlib import Path

# åŠ è½½æ¨¡å‹
ranker = LightweightRanker(model_dir=Path("models"))

# å‡†å¤‡ç‰¹å¾
df_daily = pd.read_csv("data/daily_klines/BTCUSDT_1d.csv")
df_hourly = pd.read_csv("data/hourly_klines/BTCUSDT_1h.csv")

tabular = build_tabular_vector(
    df_daily,
    signal_date=date(2025, 1, 20),
    funding_rate=0.0001,
    quote_volume=1000000,
    market_cap=500000000
)

sequence = build_hourly_sequence(
    df_hourly,
    cutoff=pd.Timestamp("2025-01-20 23:59", tz="UTC"),
    seq_len=24
)

# æ¨ç†
expected_value, pred_class, probs = ranker.predict(tabular, sequence)

print(f"æœŸæœ›æ”¶ç›Š: {expected_value:.4f}")
print(f"é¢„æµ‹ç±»åˆ«: {pred_class}")
print(f"æ¦‚ç‡åˆ†å¸ƒ: Class0={probs[0]:.2%}, Class1={probs[1]:.2%}, Class2={probs[2]:.2%}")
```

### æ¨¡å‹æ€§èƒ½

å½“å‰æ€§èƒ½æŒ‡æ ‡(éœ€è¦æ ¹æ®å®é™…è®­ç»ƒç»“æœæ›´æ–°):
- éªŒè¯é›†å‡†ç¡®ç‡: ~60-70% (å–å†³äºæ•°æ®é‡)
- æµ‹è¯•é›†å‡†ç¡®ç‡: å»ºè®®è‡³å°‘æ”¶é›†500+æ ·æœ¬
- Top-Kæ”¶ç›Šæ”¹å–„: ç›¸æ¯”ä¼ ç»Ÿæ’åºæå‡5-10%

**é‡è¦æç¤º**:
- åˆå§‹æ¨¡å‹å¯èƒ½å› æ ·æœ¬ä¸è¶³å¯¼è‡´æ³›åŒ–èƒ½åŠ›è¾ƒå¼±
- å»ºè®®å…ˆç´¯ç§¯è¶³å¤Ÿçš„å†å²äº¤æ˜“æ•°æ®(>500ç¬”)
- å®šæœŸç”¨æ–°æ•°æ®é‡æ–°è®­ç»ƒæ¨¡å‹
- åœ¨çº¸é¢äº¤æ˜“ä¸­éªŒè¯è‡³å°‘1-2ä¸ªæœˆ

### ONNXä¼˜åŒ–(å¯é€‰)

å¦‚æœæœåŠ¡å™¨èµ„æºå—é™ï¼Œå¯ä»¥è½¬æ¢ä¸ºONNXæ ¼å¼:

```bash
python scripts/convert_to_onnx.py
```

ç”Ÿæˆæ–‡ä»¶: `models/rank_model.onnx`

LightweightRankerä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä¼˜å…ˆä½¿ç”¨ONNXæ¨¡å‹ã€‚

---

## é£é™©æ§åˆ¶

### ä»“ä½ç®¡ç†

- **æœ€å¤§æŒä»“æ•°**: 10ä¸ªå“ç§
- **å•å“ç§èµ„é‡‘**: 1%è´¦æˆ·æ€»èµ„é‡‘
- **æ æ†å€æ•°**: 1x (ç°è´§åŒ–åˆçº¦)
- **æ€»é£é™©æ•å£**: æœ€å¤§10% (æ»¡ä»“æ—¶)

### æ­¢æŸæ­¢ç›ˆ

- **æ­¢ç›ˆ**: 30% (è§¦å‘åè‡ªåŠ¨å¹³ä»“)
- **æ­¢æŸ**: 150% (è§¦å‘åè‡ªåŠ¨å¹³ä»“)
- **å¹³ä»“æ–¹å¼**: ä»…é€šè¿‡æ­¢ç›ˆ/æ­¢æŸè§¦å‘ï¼Œæ— æ—¶é—´é™åˆ¶

### è®¢å•é£é™©æ§åˆ¶

1. **Makerè®¢å•è¶…æ—¶**: 60ç§’æœªæˆäº¤è‡ªåŠ¨å–æ¶ˆ
2. **é‡è¯•ä¸Šé™**: æœ€å¤š5æ¬¡è¿½å•é‡è¯•
3. **æœ€ç»ˆå…œåº•**: å¸‚ä»·å•ç¡®ä¿æ‰§è¡Œ
4. **æ»‘ç‚¹æ§åˆ¶**: é€šè¿‡é™ä»·å•é¿å…å¤§å¹…æ»‘ç‚¹

### å¸‚åœºé£é™©æ§åˆ¶

1. **æµåŠ¨æ€§è¿‡æ»¤**: æˆäº¤é‡>500ä¸‡USDT
2. **æ³¢åŠ¨ç‡è¿‡æ»¤**: ATRâ‰¥2%
3. **æ’é™¤ä¸»æµå¸**: é¿å…ä¸å¤§ç›˜é«˜åº¦ç›¸å…³
4. **å€™é€‰æ± é™åˆ¶**: æ¯å¤©åªç­›é€‰100ä¸ªæ ‡çš„

---

## ç›‘æ§è¿ç»´

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹æœ€è¿‘çš„å°æ—¶çº§æ£€æµ‹æ—¥å¿—
tail -50 logs/cron_hourly.log

# æŸ¥çœ‹å€™é€‰æ± ç­›é€‰æ—¥å¿—
tail -50 logs/cron_candidates.log

# å®æ—¶ç›‘æ§æ—¥å¿—
tail -f logs/cron_hourly.log

# æŸ¥çœ‹ç³»ç»Ÿcronæ‰§è¡Œæ—¥å¿—
sudo grep CRON /var/log/syslog | grep Quant4Little
```

### æ•°æ®æ–‡ä»¶æ£€æŸ¥

```bash
# æŸ¥çœ‹å€™é€‰æ± æ–‡ä»¶
ls -lh data/daily_scans/
cat data/daily_scans/candidates_20250124.csv

# æŸ¥çœ‹ä¿¡å·æ–‡ä»¶
ls -lh data/hourly_signals/
cat data/hourly_signals/signals_20250124_10.csv

# æŸ¥çœ‹å†å²äº¤æ˜“è®°å½•
wc -l data/backtest_trades.csv
tail -20 data/backtest_trades.csv
```

### æŒä»“ç›‘æ§

```bash
# æŸ¥çœ‹å½“å‰æŒä»“(å¦‚æœå®ç°äº†æŒä»“ç®¡ç†è„šæœ¬)
python scripts/manage_positions.py

# æŸ¥çœ‹è´¦æˆ·ä½™é¢
python scripts/check_balance.py
```

### æ¨¡å‹ç›‘æ§

```bash
# æŸ¥çœ‹æ¨¡å‹æ–‡ä»¶ä¿®æ”¹æ—¶é—´(æ£€æŸ¥æ˜¯å¦é‡è®­)
ls -lh models/

# æŸ¥çœ‹æ¨¡å‹å…ƒæ•°æ®
cat models/rank_model_meta.json | python -m json.tool

# æ£€æŸ¥æ¨¡å‹æ¨ç†æ˜¯å¦æ­£å¸¸
python scripts/lightweight_ranker.py
```

### æ€§èƒ½ç»Ÿè®¡

åˆ›å»ºè‡ªå®šä¹‰ç»Ÿè®¡è„šæœ¬ç›‘æ§:

- Makerè®¢å•æˆäº¤ç‡
- å¹³å‡ç­‰å¾…æ—¶é—´
- å¹³å‡è´¹ç”¨èŠ‚çœ
- æ¨¡å‹é¢„æµ‹å‡†ç¡®ç‡
- æ¯æ—¥ä¿¡å·æ•°é‡
- æŒä»“ç›ˆäºç»Ÿè®¡

---

## å¸¸è§é—®é¢˜

### éƒ¨ç½²ç›¸å…³

**Q: ç¬¬ä¸€æ¬¡æ‰§è¡Œä¼šåœ¨ä»€ä¹ˆæ—¶å€™?**

ä¸‹ä¸€ä¸ªæ•´ç‚¹ã€‚ä¾‹å¦‚:
- å¦‚æœç°åœ¨æ˜¯10:25ï¼Œä¸‹æ¬¡æ‰§è¡Œåœ¨11:00
- å€™é€‰æ± ç­›é€‰åœ¨æ˜å¤©æ—©ä¸Š09:00(UTC 01:00)é¦–æ¬¡æ‰§è¡Œ

**Q: å¦‚æœæ²¡æœ‰å€™é€‰æ± æ–‡ä»¶ä¼šæ€æ ·?**

å°æ—¶çº§æ£€æµ‹ä¼šè¾“å‡º:
```
å€™é€‰æ± æ–‡ä»¶ä¸å­˜åœ¨: data/daily_scans/candidates_YYYYMMDD.csv
æœ¬å°æ—¶æ— äº¤æ˜“ä¿¡å·
```

éœ€è¦æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡:
```bash
python3 scripts/daily_candidate_scan.py --top-n 100
```

**Q: å¦‚ä½•ä¸´æ—¶ç¦ç”¨äº¤æ˜“?**

æ–¹æ³•1: æ³¨é‡Šcronä»»åŠ¡
```bash
crontab -e
# åœ¨äº¤æ˜“ä»»åŠ¡å‰åŠ  # å·
```

æ–¹æ³•2: åˆ é™¤æ‰€æœ‰ä»»åŠ¡
```bash
bash deploy/clear_crontab.sh
```

æ–¹æ³•3: ä¿®æ”¹ä»£ç ä¸­çš„max_positions=0

**Q: å¦‚ä½•å›æ»šåˆ°ä¹‹å‰çš„é…ç½®?**

```bash
# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
ls -lt /tmp/crontab_backup_*.txt

# æ¢å¤æŒ‡å®šå¤‡ä»½
crontab /tmp/crontab_backup_YYYYMMDD_HHMMSS.txt

# éªŒè¯
crontab -l
```

### äº¤æ˜“ç›¸å…³

**Q: Makerè®¢å•æˆäº¤ç‡ä½æ€ä¹ˆåŠ?**

è°ƒæ•´å‚æ•°:
```python
executor = MakerOrderExecutor(
    maker_offset_pct=0.05,  # é™ä½åç§»é‡(å½“å‰0.10)
    max_wait_seconds=90     # å¢åŠ ç­‰å¾…æ—¶é—´(å½“å‰60)
)
```

æˆ–ç›´æ¥ä¿®æ”¹ [scripts/live_maker_trader.py](scripts/live_maker_trader.py) ä¸­çš„é»˜è®¤å€¼ã€‚

**Q: å¦‚ä½•ç¡®è®¤å®šæ—¶ä»»åŠ¡çœŸçš„åœ¨è¿è¡Œ?**

1. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—:
   ```bash
   sudo grep CRON /var/log/syslog | grep Quant4Little | tail -10
   ```

2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—:
   ```bash
   ls -lth logs/
   ```

3. ç­‰åˆ°æ•´ç‚¹åæ£€æŸ¥:
   ```bash
   tail -50 logs/cron_hourly.log
   ```

**Q: æŒä»“è¶…è¿‡10ä¸ªæ€ä¹ˆåŠ?**

ç³»ç»Ÿä¼šè‡ªåŠ¨æ‹’ç»æ–°è®¢å•:
```
å½“å‰æŒä»“: 10
å¯ç”¨æ§½ä½: 0
è·³è¿‡æœ¬æ¬¡äº¤æ˜“
```

éœ€è¦ç­‰å¾…å·²æœ‰æŒä»“å¹³ä»“åæ‰èƒ½å¼€æ–°ä»“ã€‚

### æ¨¡å‹ç›¸å…³

**Q: æ¨¡å‹é¢„æµ‹ä¸å‡†ç¡®æ€ä¹ˆåŠ?**

1. **æ”¶é›†æ›´å¤šæ•°æ®**:
   ```bash
   python scripts/backtester.py --start 2024-01-01 --end 2025-01-31
   ```

2. **é‡æ–°è®­ç»ƒæ¨¡å‹**:
   ```bash
   python scripts/modeling/train_ranker.py --epochs 50
   ```

3. **è°ƒæ•´ç‰¹å¾å·¥ç¨‹**: ä¿®æ”¹ [scripts/modeling/features.py](scripts/modeling/features.py)

4. **ç¦ç”¨æ¨¡å‹,ä½¿ç”¨ä¼ ç»Ÿæ’åº**:
   - ç¼–è¾‘ [deploy/cron_hourly_detect.sh](deploy/cron_hourly_detect.sh)
   - ç§»é™¤ `--use-model` å‚æ•°

**Q: å¦‚ä½•è¯„ä¼°æ¨¡å‹æ•ˆæœ?**

```python
# åˆ›å»ºè¯„ä¼°è„šæœ¬
from scripts.lightweight_ranker import LightweightRanker
import pandas as pd

ranker = LightweightRanker()
signals = pd.read_csv("data/hourly_signals/signals_20250124_10.csv")

# ç»Ÿè®¡é¢„æµ‹åˆ†å¸ƒ
print(signals["pred_class"].value_counts())
print(f"å¹³å‡æœŸæœ›å€¼: {signals['expected_value'].mean():.4f}")
print(f"Top-10å¹³å‡æœŸæœ›å€¼: {signals.head(10)['expected_value'].mean():.4f}")
```

**Q: æ¨¡å‹æ¨ç†é€Ÿåº¦å¤ªæ…¢æ€ä¹ˆåŠ?**

1. è½¬æ¢ä¸ºONNXæ ¼å¼(3-5xåŠ é€Ÿ)
2. å‡å°‘å€™é€‰æ± å¤§å°(ä»100é™åˆ°50)
3. å¢åŠ æœåŠ¡å™¨CPUæ ¸å¿ƒæ•°
4. ä½¿ç”¨æ›´å°çš„æ¨¡å‹æ¶æ„

### æ•°æ®ç›¸å…³

**Q: æ•°æ®ä¸‹è½½å¤±è´¥æ€ä¹ˆåŠ?**

1. æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œä»£ç†é…ç½®
2. æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—: `tail -50 logs/cron_candidates.log`
4. æ‰‹åŠ¨é‡è¯•: `python3 scripts/daily_candidate_scan.py --top-n 100`

**Q: å†å²æ•°æ®åœ¨å“ªé‡Œ?**

```
data/
â”œâ”€â”€ daily_klines/           # æ—¥çº¿æ•°æ®
â”œâ”€â”€ hourly_klines/          # å°æ—¶çº¿æ•°æ®
â”œâ”€â”€ daily_scans/            # æ¯æ—¥å€™é€‰æ± 
â”œâ”€â”€ hourly_signals/         # æ¯å°æ—¶ä¿¡å·
â””â”€â”€ backtest_trades.csv     # å†å²äº¤æ˜“(è®­ç»ƒæ•°æ®)
```

è¿™äº›ç›®å½•åœ¨ `.gitignore` ä¸­è¢«å¿½ç•¥ï¼Œä¸ä¼šæäº¤åˆ°Gitã€‚

**Q: å¦‚ä½•æ¸…ç†æ—§æ•°æ®?**

```bash
# æ¸…ç†60å¤©å‰çš„Kçº¿æ•°æ®
find data/daily_klines -mtime +60 -delete
find data/hourly_klines -mtime +60 -delete

# æ¸…ç†7å¤©å‰çš„å€™é€‰æ± å’Œä¿¡å·
find data/daily_scans -mtime +7 -delete
find data/hourly_signals -mtime +7 -delete

# ä¿ç•™äº¤æ˜“è®°å½•(ä¸è¦åˆ é™¤backtest_trades.csv!)
```

---

## é¡¹ç›®ç»´æŠ¤

### Gitç®¡ç†

```bash
# åˆå§‹åŒ–ä»“åº“
git init
git add .
git commit -m "åˆå§‹åŒ–é‡åŒ–ç­–ç•¥é¡¹ç›®"

# æ¨é€åˆ°GitHub
git remote add origin https://github.com/xxx/Quant4Little.git
git push -u origin main

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main
```

### ä¾èµ–æ›´æ–°

```bash
# æ›´æ–°æ‰€æœ‰ä¾èµ–
pip install --upgrade -r requirements.txt

# æ›´æ–°å•ä¸ªä¾èµ–
pip install --upgrade ccxt
```

### å¤‡ä»½ç­–ç•¥

å®šæœŸå¤‡ä»½é‡è¦æ–‡ä»¶:
- `models/` - æ¨¡å‹æƒé‡
- `data/backtest_trades.csv` - äº¤æ˜“è®°å½•
- `.env` - ç¯å¢ƒå˜é‡(æ³¨æ„å®‰å…¨!)
- æ—¥å¿—æ–‡ä»¶(å¯é€‰)

---

## æ‰©å±•åŠŸèƒ½

### å»ºè®®æ·»åŠ çš„åŠŸèƒ½

1. **æŒä»“ç®¡ç†è„šæœ¬**:
   - è‡ªåŠ¨ç›‘æ§æŒä»“ç›ˆäº
   - åˆ°æœŸè‡ªåŠ¨å¹³ä»“
   - æ­¢ç›ˆæ­¢æŸè§¦å‘

2. **å‘Šè­¦é€šçŸ¥**:
   - Telegram/é’‰é’‰æœºå™¨äºº
   - å¼‚å¸¸è®¢å•å‘Šè­¦
   - ç›ˆäºæé†’

3. **æ€§èƒ½ä»ªè¡¨æ¿**:
   - Webç•Œé¢å±•ç¤ºç»Ÿè®¡
   - å®æ—¶æŒä»“ç›‘æ§
   - æ¨¡å‹æ€§èƒ½è¿½è¸ª

4. **è‡ªåŠ¨é‡è®­**:
   - å®šæœŸç”¨æ–°æ•°æ®é‡è®­æ¨¡å‹
   - A/Bæµ‹è¯•æ–°æ—§æ¨¡å‹
   - è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ¨¡å‹

5. **é£æ§å¢å¼º**:
   - åŠ¨æ€è°ƒæ•´ä»“ä½å¤§å°
   - å¸‚åœºæƒ…ç»ªæŒ‡æ ‡
   - ç›¸å…³æ€§åˆ†æ

---

## å…è´£å£°æ˜

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚

**é£é™©æç¤º**:
- åŠ å¯†è´§å¸äº¤æ˜“å…·æœ‰æé«˜é£é™©ï¼Œå¯èƒ½å¯¼è‡´æœ¬é‡‘å…¨éƒ¨æŸå¤±
- å†å²å›æµ‹ä¸ä»£è¡¨æœªæ¥æ”¶ç›Š
- æ¨¡å‹é¢„æµ‹ä¸ä¿è¯å‡†ç¡®æ€§
- å»ºè®®ä»å°èµ„é‡‘æµ‹è¯•å¼€å§‹
- åŠ¡å¿…åœ¨æµ‹è¯•ç½‘å……åˆ†éªŒè¯åå†ä½¿ç”¨å®ç›˜

ä½¿ç”¨æœ¬ç³»ç»Ÿé€ æˆçš„ä»»ä½•æŸå¤±ï¼Œå¼€å‘è€…ä¸æ‰¿æ‹…è´£ä»»ã€‚

---

## è´¡çŒ®ä¸æ”¯æŒ

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åœ¨GitHubä»“åº“æäº¤Issueã€‚

---

## è®¸å¯è¯

MIT License

---

**ç¥äº¤æ˜“é¡ºåˆ©ï¼** ğŸ“ˆ
